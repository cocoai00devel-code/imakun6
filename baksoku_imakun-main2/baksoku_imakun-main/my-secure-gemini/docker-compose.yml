services:
  # --- ğŸš€ ç„é–¢ (Go): ä¿å­˜ã—ãŸã‚‰å³åæ˜  (Hot Reload) ---
  gateway:
    build: 
      context: ./gateway
      dockerfile: Dockerfile
    container_name: fortress-gateway
    ports:
      - "3000:3000"
    volumes:
      - ./gateway:/app # ğŸ‘ˆ æ‰‹å…ƒã®ã‚³ãƒ¼ãƒ‰ã‚’åŒæœŸ
    # air ãªã©ã®ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã†ã¨ã€ä¿å­˜æ™‚ã«è‡ªå‹•ã§ go run ã—ç›´ã—ã¦ãã‚Œã¾ã™
    command: go run main.go 
    depends_on:
      - policy-engine
      - rust-backend
    networks:
      - fortress-net

  # --- âš–ï¸ å¯©åˆ¤æ‰€ (Haskell): ã‚­ãƒ£ãƒƒã‚·ãƒ¥å±¤ã‚’åˆ†ã‘ãŸæœ€å¼·ãƒ“ãƒ«ãƒ‰ ---
  policy-engine:
    build:
      context: ./policy-server
      # å…ˆã»ã©ä½œæˆã—ãŸãƒãƒ«ãƒã‚¹ãƒ†ãƒ¼ã‚¸Dockerfileã‚’æŒ‡å®š
      dockerfile: Dockerfile 
    container_name: fortress-policy
    expose:
      - "8000"
    networks:
      - fortress-net

  # --- ğŸ›¡ï¸ é‡‘åº« (Rust): é–‹ç™ºæ™‚ã¯é«˜é€Ÿã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ãƒ¢ãƒ¼ãƒ‰ ---
  rust-backend:
    build: ./backend
    container_name: fortress-backend
    volumes:
      - ./backend:/app
      - cargo-cache:/usr/local/cargo/registry # ğŸ‘ˆ Rustã®ãƒ“ãƒ«ãƒ‰ã‚’çˆ†é€ŸåŒ–
    expose:
      - "5000"
    env_file:
      - .env
    networks:
      - fortress-net

networks:
  fortress-net:
    driver: bridge

volumes:
  cargo-cache: # Rustã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä¿å­˜ã—ã¦ãŠãé ˜åŸŸ


# services:
#   # --- ğŸš€ æœ€æ–°éµä»˜ãç„é–¢ï¼ˆGoï¼‰Goã‚»ã‚­ãƒ¥ã‚¢ãƒ»ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ (Go) ã€æ–°è¨­ï¼ã€‘ ç¬¬2å±¤ï¼šGo ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ (å”¯ä¸€ã®çª“å£) ---
#   gateway:
#     build: ./gateway
#     container_name: fortress-gateway
#     ports:
#       - "3000:3000"
#     depends_on:
#       - policy-engine
#       - rust-backend
#     networks:
#       - fortress-net

#   # --- âš–ï¸ å¯©åˆ¤æ‰€ï¼ˆHaskellï¼‰ ç¬¬3å±¤ï¼šHaskell å¯©åˆ¤æ‰€ (è«–ç†ãƒã‚§ãƒƒã‚¯) ---
#   policy-engine:
#     build: ./policy-server
#     container_name: fortress-policy
#     expose:
#       - "8000"
#     networks:
#       - fortress-net

#   # --- ğŸ›¡ï¸ ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰è¦å¡ (Rust) ç¬¬4å±¤ï¼šRust é‡‘åº« (APIå®Ÿè¡Œ) ---
#   rust-backend:
#     build: ./backend
#     container_name: fortress-backend
#     expose:
#       - "5000"
#     env_file:
#       - .env  # ğŸ‘ˆ ã“ã“ã« GEMINI_API_KEY ã‚’æ›¸ã„ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç½®ã
#     networks:
#       - fortress-net

# networks:
#   fortress-net:
#     driver: bridge




# services:
#   # ğŸ›¡ï¸ ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰è¦å¡ (Rust)
#   # backend:
#   #   build: ./backend
#   #   ports:
#   #     - "3000:3000"
#   #   env_file:
#   #     - ./backend/.env

#    # ğŸ›¡ï¸ ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰è¦å¡ (Rust)
#   backend:
#     build: ./backend
#     # portsï¼ˆå¤–éƒ¨å…¬é–‹ï¼‰ã‚’å‰Šé™¤ã—ã€exposeï¼ˆå†…éƒ¨å…¬é–‹ï¼‰ã«å¤‰æ›´
#     expose:
#       - "8080"
#     env_file:
#       - ./backend/.env

#   # ğŸ¨ ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å¤–è£… (React + TS)
#   # frontend:
#   #   build: ./frontend
#   #   ports:
#   #     - "5173:5173"
#   #   depends_on:
#   #     - backend



#   frontend:
#     build: ./frontend
#     ports:
#       - "5173:5173"
#     depends_on:
#       - gateway # ğŸ‘ˆ GoãŒå‹•ã„ã¦ã‹ã‚‰èµ·å‹•ã™ã‚‹ã‚ˆã†ã«å¤‰æ›´

#   # ğŸš€ Goã‚»ã‚­ãƒ¥ã‚¢ãƒ»ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ (Go) ã€æ–°è¨­ï¼ã€‘
#   gateway:
#     build: ./gateway
#     ports:
#       - "3000:3000" # ğŸ‘ˆ å¤–éƒ¨ã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹ï¼ˆç„é–¢å£ï¼‰ã‚’GoãŒæ‹…å½“
#     environment:
#       - BACKEND_URL=ws://backend:8080/ws
#     depends_on:
#       - backend
  
#    services:
#   # å¯©åˆ¤æ‰€ï¼ˆHaskellï¼‰
#   policy-engine:
#     build: ./policy-server
#     # å¤–éƒ¨ã«ã¯å…¬é–‹ã›ãšã€å†…éƒ¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã§ã®ã¿å¾…æ©Ÿ
#     expose:
#       - "8000"

#   # ç„é–¢ï¼ˆGoï¼‰
#   gateway:
#     build: ./gateway
#     ports:
#       - "3000:3000" # ã“ã“ã ã‘ãŒå¤–ã®ä¸–ç•Œã¨ç¹‹ãŒã‚‹
#     depends_on:
#       - policy-engine
#       - backend

 